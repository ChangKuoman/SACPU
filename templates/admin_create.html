<html>
    <head>
        <title>
            SACPU - Admin
        </title>
        <link rel="shortcut icon" type="image/png" href="/static/img/favicon.ico">
        <link rel="stylesheet" href="/static/css/style.css">
    </head>

    <body>
        <div id="error" class="hidden">
            <p class="error_text" id="error_text">

            </p>
        </div>

        <div>
            <h2>CREATE MOTHERBOARD</h2>

            <form id="form_motherboard">
                <p>Nombre de la tarjeta madre</p>
                <input type="text" id="motherboard_name"/>
                <P>Descripción de la Tajeta Madre</P>
                <input type="text" id="motherboard_description"/>
                <P>Precio</P>
                <input type="number" id="motherboard_price" step="0.01"/>
                <input type="submit" value="Submit"/>
            </form>
        </div>

        <div>
            <h2>CREATE COMPONENT</h2>

            <form id="form_component">
                <p>Nombre del Componente</p>
                <input type="text" id="component_name"/>
                <P>Descripción del Componente</P>
                <input type="text" id="component_description"/>
                <P>Tipo de Componente</P>
                <input type="text" id="component_type"/>
                <P>Precio</P>
                <input type="number" id="component_price" step="0.01"/>
                <input type="submit" value="Submit"/>
            </form>
        </div>

        <div>
            <h2>CREATE COMPATIBLE</h2>
            
            <form id="form_compatible">
                <p>Motherboard</p>
                <select name="motherboard" id="id_motherboard">
                    {% for motherboard in motherboards %}
                    <option value={{motherboard.id}}>{{motherboard.name}}</option>
                    {% endfor %}
                </select>

                <p>Component</p>
                <select name="component" id="id_component">
                    {% for component in components %}
                    <option value={{component.id}}>{{component.name}}</option>
                    {% endfor %}
                </select>
                <input type="submit" value="Submit"/>
            </form>
        </div>

    </body>

    <script>
        // function for motherboard form
        document.getElementById('form_motherboard').onsubmit = function(e) {
            e.preventDefault();
            const motherboard_name = document.getElementById('motherboard_name').value;
            const motherboard_description = document.getElementById('motherboard_description').value;
            const motherboard_price = document.getElementById('motherboard_price').value;
            fetch('/admin/create/motherboard', {
                method: 'POST',
                body: JSON.stringify({
                    'motherboard_name': motherboard_name,
                    'motherboard_description': motherboard_description,
                    'motherboard_price': motherboard_price
                }),
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(
                response => response.json()
            ).then(function(jsonResponse){
                console.log(jsonResponse);
                
                if (jsonResponse['error']){
                    // when is an error
                    window.location.href = '/errors/500';
                }
                else if (! jsonResponse['invalid_register']){
                    // when register is successful
                    alert("MOTHERBOARD ADDED SUCCESSFULLY");
                    document.getElementById('form_motherboard').reset();
                }
                else {
                    // when register is NOT successful
                    document.getElementById('error_text').textContent = String(jsonResponse['invalid_register']);
                    document.getElementById('error').className = '';
                }
                
            }).catch(function() {
                console.log('error_register')
            });
        }
        // function for on change error
        document.getElementById('form_motherboard').onchange = function(e){
            document.getElementById('error').className = 'hidden';
        }

        // function for form_component form
        document.getElementById('form_component').onsubmit = function(e) {
            e.preventDefault();
            const component_name = document.getElementById('component_name').value;
            const component_description = document.getElementById('component_description').value;
            const component_type = document.getElementById('component_type').value;
            const component_price = document.getElementById('component_price').value;
            fetch('/admin/create/component', {
                method: 'POST',
                body: JSON.stringify({
                    'component_name': component_name,
                    'component_description': component_description,
                    'component_type': component_type,
                    'component_price': component_price
                }),
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(
                response => response.json()
            ).then(function(jsonResponse){
                console.log(jsonResponse);
                
                if (jsonResponse['error']){
                    // when is an error
                    window.location.href = '/errors/500';
                }
                else if (! jsonResponse['invalid_register']){
                    // when register is successful
                    alert("COMPONENT ADDED SUCCESSFULLY");
                    document.getElementById('form_component').reset();
                }
                else {
                    // when register is NOT successful
                    document.getElementById('error_text').textContent = String(jsonResponse['invalid_register']);
                    document.getElementById('error').className = '';
                }
                
            }).catch(function() {
                console.log('error_register')
            });
        }
        // function for on change error
        document.getElementById('form_component').onchange = function(e){
            document.getElementById('error').className = 'hidden';
        }

    </script>

</html>